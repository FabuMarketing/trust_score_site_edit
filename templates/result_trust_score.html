<!DOCTYPE html>
<html>
<head>
  <title>Trust Score Result</title>
  <link rel="icon" href="{{ url_for('static', filename='favicon.ico') }}">
  <style>
      body {
          font-family: 'Arial', sans-serif;
          background-color: #f0f4f8;
          padding: 0;
          margin: 0;
      }
      .container {
          background: white;
          width: 95%;
          margin: auto;
          padding: 30px;
          border-radius: 12px;
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      }
      h2, h3 {
          text-align: center;
          color: #333;
      }
      .error {
          color: red;
          text-align: center;
      }
      .table-container {
          overflow-x: auto; /* Enables horizontal scrolling */
          margin-top: 20px;
      }
      table {
          width: 100%;
          border-collapse: collapse;
          font-size: 14px;
          min-width: 1200px; /* Ensures the table doesn't shrink too much */
      }
      table, th, td {
          border: 1px solid #ddd;
      }
      th, td {
          padding: 12px;
          text-align: center;
      }
      th {
          background-color: #0A152C;
          color: white;
      }
      tr:nth-child(even) {
          background-color: #f9f9f9;
      }
      tr:hover {
          background-color: #f1f1f1;
      }
      .button-container {
          text-align: center;
          margin-top: 20px;
      }
      .button-container button {
          padding: 10px 20px;
          font-size: 16px;
          background-color: #0A152C;
          color: white;
          border: none;
          border-radius: 6px;
          cursor: pointer;
          margin: 5px;
      }
      .button-container button:hover {
          background-color: #081024;
      }
  </style>
</head>
<body>
  <div class="container">
      {% if error %}
          <h2 class="error">{{ error }}</h2>
      {% else %}
          <h2>Partner Name: {{ partner_name }}</h2>
          <h3>
              Trust Score Rating:
              <span class="{% if trust_score > 50 %}trust-score-green{% elif trust_score >= 30 %}trust-score-orange{% else %}trust-score-red{% endif %}">
                  {{ trust_score }}
              </span>
          </h3>

          <h3>Affiliate Brands</h3>
          <div class="table-container">
              <table>
                  <tr>
                      <th>Affiliate Brand</th>
                      <th>Program Joined Date</th>
                      <th>Publisher Joined Date</th>
                      <th>Revenue</th>
                      <th>Action</th>
                      <th>Click</th>
                      <th>CR%</th>
                  </tr>
                  {% for brand in affiliate_brands %}
                  <tr>
                      <td>{{ brand['affiliate brand'] }}</td>
                      <td>{{ brand['program joined date'] }}</td>
                      <td>{{ brand['publisher joined date'] }}</td>
                      <td>{{ brand['revenue'] }}</td>
                      <td>{{ brand['order/action'] }}</td>
                      <td>{{ brand['clicks'] }}</td>
                      <td>
                          {% if brand['cr'] is defined and brand['cr'] is not none %}
                              {{ brand['cr'] | round(2) }}
                          {% else %}
                              N/A
                          {% endif %}
                      </td>
                  </tr>
                  {% endfor %}
              </table>
          </div>

          <h3>Top Similar Partners</h3>
          <div class="table-container">
              <table>
                  <tr>
                      <th>Partner Name</th>
                      <th>Trust Score</th>
                      <th>Age Rank</th>
                      <th>Ahrefs DR</th>
                      <th>Semrush DR</th>
                      <th>Moz DR</th>
                      <th>URL</th>
                      <th>Contact Name</th>
                      <th>Email</th>
                      <th>Work</th>
                      <th>Cell</th>
                      <th>Pub Category</th>
                      <th>Advertiser Type</th>
                  </tr>
                  {% for pub in similar_partners %}
                  <tr>
                      <td>{{ pub['partner name'] }}</td>
                      <td>{{ pub['trust score rating'] }}</td>
                      <td>{{ pub['age rank'] }}</td>
                      <td>{{ pub['ahrefs dr'] }}</td>
                      <td>{{ pub['semrush dr'] }}</td>
                      <td>{{ pub['moz dr'] }}</td>
                      <td><a href="{{ pub['url'] }}" target="_blank">{{ pub['url'] }}</a></td>
                      <td>{{ pub['contact name'] }}</td>
                      <td>{{ pub['email'] }}</td>
                      <td>{{ pub['work'] }}</td>
                      <td>{{ pub['cell'] }}</td>
                      <td>{{ pub['pub category'] }}</td>
                      <td>{{ pub['advertiser type'] }}</td>
                  </tr>
                  {% endfor %}
              </table>
          </div>

          <div class="button-container">
              <button onclick="downloadCSV()">Download as CSV</button>
              <button onclick="downloadPDF()">Download as PDF</button>
              <button onclick="window.location.href='/'">Return to Search</button>
          </div>
      {% endif %}
  </div>
  <script>
      function downloadCSV() {
          fetch('/download_csv', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ publishers: {{ similar_partners|tojson }} })
          })
          .then(response => response.blob())
          .then(blob => {
              const url = window.URL.createObjectURL(blob);
              const a = document.createElement('a');
              a.style.display = 'none';
              a.href = url;
              a.download = 'similar_partners.csv';
              document.body.appendChild(a);
              a.click();
              window.URL.revokeObjectURL(url);
          });
      }

      function downloadPDF() {
          alert('PDF generation not implemented yet.');
      }
  </script>
</body>
</html>